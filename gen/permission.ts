// Code generated by protoc-gen-ts_proto. DO NOT EDIT.
// versions:
//   protoc-gen-ts_proto  v2.11.0
//   protoc               v7.34.0
// source: permission.proto

/* eslint-disable */
import { GrpcMethod, GrpcStreamMethod } from "@nestjs/microservices";
import { Observable } from "rxjs";

export const protobufPackage = "csr.v1";

export enum SubjectType {
  SUBJECT_TYPE_UNSPECIFIED = 0,
  USER = 1,
  COMPANY = 2,
  SERVICE = 3,
  UNRECOGNIZED = -1,
}

export enum Decision {
  DECISION_UNSPECIFIED = 0,
  ALLOW = 1,
  DENY = 2,
  UNRECOGNIZED = -1,
}

export interface Subject {
  id: string;
  type: SubjectType;
  externalId: string;
  companyId: string;
}

export interface Role {
  id: string;
  code: string;
  name: string;
  level: number;
  isDelegatable: boolean;
  maxDepth?: number | undefined;
}

export interface Scope {
  /** seller, company, location */
  type: string;
  /** seller-123 */
  value: string;
}

export interface Permission {
  /** product.publish */
  name: string;
  resource: string;
  action: string;
}

export interface PolicyDecision {
  decision: Decision;
  permission: string;
  effectiveRole: Role | undefined;
  scope: Scope | undefined;
  explain: PolicyExplain | undefined;
}

export interface PolicyExplain {
  matchedRule: string;
  /** ==, in, contains */
  relation: string;
  entityAttributes: { [key: string]: string };
  delegationPath: DelegationStep[];
}

export interface PolicyExplain_EntityAttributesEntry {
  key: string;
  value: string;
}

export interface DelegationStep {
  fromSubjectId: string;
  toSubjectId: string;
  roleCode: string;
  scope: Scope | undefined;
}

export interface CheckPermissionRequest {
  actor: Subject | undefined;
  permission: string;
  scope:
    | Scope
    | undefined;
  /** optional resource context */
  entityAttributes: { [key: string]: string };
}

export interface CheckPermissionRequest_EntityAttributesEntry {
  key: string;
  value: string;
}

export interface CheckPermissionResponse {
  result: PolicyDecision | undefined;
}

export interface CreateDelegationRequest {
  parentSubjectId: string;
  childSubjectId: string;
  roleCode: string;
  scope: Scope | undefined;
}

export interface CreateDelegationResponse {
  success: boolean;
}

export interface ListDelegationsRequest {
  subjectId: string;
  scope: Scope | undefined;
}

export interface ListDelegationsResponse {
  delegations: Delegation[];
}

export interface Delegation {
  id: string;
  parentSubjectId: string;
  childSubjectId: string;
  role: Role | undefined;
  scope: Scope | undefined;
  depth: number;
}

export interface AssignRoleRequest {
  subjectId: string;
  roleCode: string;
  scope: Scope | undefined;
}

export interface AssignRoleResponse {
  success: boolean;
}

export interface SyncPermissionsRequest {
  serviceName: string;
  permissions: Permission[];
  /** build-time defaults */
  hidden: boolean;
}

export interface SyncPermissionsResponse {
  policyVersion: string;
}

export interface GetPolicyVersionRequest {
  companyId: string;
}

export interface GetPolicyVersionResponse {
  policyVersion: string;
}

export const CSR_V1_PACKAGE_NAME = "csr.v1";

export interface CSRServiceClient {
  /** üîê Core authorization check */

  checkPermission(request: CheckPermissionRequest): Observable<CheckPermissionResponse>;

  /** üîÅ Delegation management */

  createDelegation(request: CreateDelegationRequest): Observable<CreateDelegationResponse>;

  listDelegations(request: ListDelegationsRequest): Observable<ListDelegationsResponse>;

  /** üé≠ Role assignment */

  assignRole(request: AssignRoleRequest): Observable<AssignRoleResponse>;

  /** üîÑ Permission sync from services */

  syncPermissions(request: SyncPermissionsRequest): Observable<SyncPermissionsResponse>;

  /** üß† Policy versioning */

  getPolicyVersion(request: GetPolicyVersionRequest): Observable<GetPolicyVersionResponse>;
}

export interface CSRServiceController {
  /** üîê Core authorization check */

  checkPermission(
    request: CheckPermissionRequest,
  ): Promise<CheckPermissionResponse> | Observable<CheckPermissionResponse> | CheckPermissionResponse;

  /** üîÅ Delegation management */

  createDelegation(
    request: CreateDelegationRequest,
  ): Promise<CreateDelegationResponse> | Observable<CreateDelegationResponse> | CreateDelegationResponse;

  listDelegations(
    request: ListDelegationsRequest,
  ): Promise<ListDelegationsResponse> | Observable<ListDelegationsResponse> | ListDelegationsResponse;

  /** üé≠ Role assignment */

  assignRole(
    request: AssignRoleRequest,
  ): Promise<AssignRoleResponse> | Observable<AssignRoleResponse> | AssignRoleResponse;

  /** üîÑ Permission sync from services */

  syncPermissions(
    request: SyncPermissionsRequest,
  ): Promise<SyncPermissionsResponse> | Observable<SyncPermissionsResponse> | SyncPermissionsResponse;

  /** üß† Policy versioning */

  getPolicyVersion(
    request: GetPolicyVersionRequest,
  ): Promise<GetPolicyVersionResponse> | Observable<GetPolicyVersionResponse> | GetPolicyVersionResponse;
}

export function CSRServiceControllerMethods() {
  return function (constructor: Function) {
    const grpcMethods: string[] = [
      "checkPermission",
      "createDelegation",
      "listDelegations",
      "assignRole",
      "syncPermissions",
      "getPolicyVersion",
    ];
    for (const method of grpcMethods) {
      const descriptor: any = Reflect.getOwnPropertyDescriptor(constructor.prototype, method);
      GrpcMethod("CSRService", method)(constructor.prototype[method], method, descriptor);
    }
    const grpcStreamMethods: string[] = [];
    for (const method of grpcStreamMethods) {
      const descriptor: any = Reflect.getOwnPropertyDescriptor(constructor.prototype, method);
      GrpcStreamMethod("CSRService", method)(constructor.prototype[method], method, descriptor);
    }
  };
}

export const CSR_SERVICE_NAME = "CSRService";
